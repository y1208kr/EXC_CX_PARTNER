<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í˜„ëŒ€ì œì²  B2B CX ì†”ë£¨ì…˜ ë©</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #f4f7f6; /* Lighter steel gray */
        }
        .slide {
            background-color: white;
            border-radius: 0.75rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.05), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            padding: 2.5rem;
            display: none; /* Initially hidden */
            flex-direction: column;
            justify-content: space-between; /* To push nav buttons to bottom */
            min-height: 700px;
            border: 1px solid #dee2e6; /* Light gray border */
        }
        .gemini-button {
            background-color: #004A9E; /* Hyundai Primary Blue */
            color: white;
            font-weight: bold;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            transition: background-color 0.3s, transform 0.2s, opacity 0.3s;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .gemini-button:hover {
            background-color: #003B7F; /* Darker Blue */
            transform: translateY(-2px);
        }
        .gemini-button:disabled {
            background-color: #6c757d;
            opacity: 0.7;
            cursor: not-allowed;
            transform: none;
        }
        .nav-button {
            background-color: #f1f1f1;
            color: #555;
            font-weight: bold;
            padding: 0.6rem 1.2rem;
            border-radius: 0.5rem;
            transition: all 0.3s;
        }
        .nav-button:hover {
            background-color: #e0e0e0;
        }
        .nav-button:disabled {
            background-color: #f9f9f9;
            color: #ccc;
            cursor: not-allowed;
        }
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border-left-color: #004A9E; /* Hyundai Blue */
            animation: spin 1s ease infinite;
        }
        .button-spinner {
            border: 2px solid rgba(255, 255, 255, 0.2);
            width: 1rem;
            height: 1rem;
            border-radius: 50%;
            border-left-color: #ffffff;
            animation: spin 1s ease infinite;
            display: inline-block;
            margin-right: 0.5rem;
            vertical-align: middle;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        header { 
            background-color: #2c2c2c; 
            padding: 2.5rem 1rem;
        }
        footer { background-color: #2c2c2c; }
        h1, h2, h3, h4 { color: #2c2c2c; }
        input, textarea, select {
            background-color: #fcfcfc;
            border-color: #ced4da; /* Gray border */
        }
        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #004A9E; /* Hyundai Blue */
            box-shadow: 0 0 0 2px rgba(0, 74, 158, 0.2); /* Blue glow */
        }
        /* Progress Indicator Styles */
        .step { position: relative; }
        .step-circle {
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            background-color: #e0e0e0;
            color: #757575;
            transition: all 0.3s ease;
            font-size: 1rem;
            border: 3px solid #e0e0e0;
        }
        .step-label { color: #757575; font-size: 0.8rem; margin-top: 0.5rem; transition: all 0.3s ease; }
        .step.active .step-circle { background-color: #004A9E; color: white; border-color: #004A9E;}
        .step.active .step-label { font-weight: bold; color: #004A9E; }
        .step.completed .step-circle { background-color: #fff; color: #004A9E; border-color: #004A9E;}
        .step-connector { flex-grow: 1; height: 3px; background-color: #e0e0e0; }
        .learning-objective {
            background-color: #EBF5FF; /* Light Blue */
            border-left: 4px solid #004A9E; /* Hyundai Blue */
            padding: 0.75rem 1rem;
            margin-bottom: 1.5rem;
        }
        .context-box {
            background-color: #EBF5FF; /* Light Blue */
            border-left: 4px solid #004A9E; /* Hyundai Blue */
            padding: 0.75rem 1rem;
            margin-bottom: 1.5rem;
            border-radius: 0.25rem;
        }
        /* ê°œì¡°ì‹ í¬ë§·íŒ…ì„ ìœ„í•œ ìŠ¤íƒ€ì¼ */
        #modal-text h4 {
            font-weight: 700;
            font-size: 1.1rem;
            color: #2c2c2c;
            margin-top: 1.25rem;
            margin-bottom: 0.5rem;
            border-bottom: 1px solid #eee;
            padding-bottom: 0.25rem;
        }
        #modal-text ul {
            list-style-type: disc;
            list-style-position: outside;
            margin-left: 1.25rem;
            margin-bottom: 1rem;
            space-y: 0.25rem;
        }
        #modal-text p {
            margin-bottom: 0.75rem;
            line-height: 1.6;
        }
        #modal-text strong {
            font-weight: 700;
            color: #004A9E;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <header class="text-white text-center px-4 shadow-lg relative">
        <h1 class="text-4xl md:text-5xl font-black mb-2 text-white">í˜„ëŒ€ì œì²  B2B CX ì†”ë£¨ì…˜ ë©</h1>
        <p class="text-lg md:text-xl text-[#90CAF9]">AIì™€ í•¨ê»˜ ê¸°ìˆ  ì„œë¹„ìŠ¤ì˜ ëª¨ë“  ìˆœê°„ì„ ë””ìì¸í•©ë‹ˆë‹¤.</p>
        <button id="clear-data-btn" class="absolute top-4 right-4 text-xs bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded-lg shadow">ğŸ”„ ë°ì´í„° ì´ˆê¸°í™”</button>
    </header>

    <main class="container mx-auto p-4 md:p-8 max-w-6xl">
        <div id="progress-indicator" 
             class="flex items-center w-full mb-8"
             role="progressbar" 
             aria-valuenow="1" 
             aria-valuemin="1" 
             aria-valuemax="7"
             aria-label="í•™ìŠµ ì§„í–‰ ë‹¨ê³„">
        </div>
        <div id="slideshow-container" class="relative">
            <!-- Slide 1: B2B ê³ ê° í˜ë¥´ì†Œë‚˜ -->
            <div class="slide">
                <div>
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold">M1: B2B ê³ ê° í˜ë¥´ì†Œë‚˜ ì •ì˜</h2>
                        <span class="font-bold text-gray-400">1 / 7</span>
                    </div>
                    <div class="learning-objective">
                        <p class="font-bold text-sm">ğŸ’¡ ì˜¤ëŠ˜ì˜ í•™ìŠµ ëª©í‘œ</p>
                        <p class="text-xs text-gray-600">B2B ê³ ê°(êµ¬ë§¤íŒ€, ì—°êµ¬ì†Œ ë“±)ì˜ ë³µì¡í•œ ë‹ˆì¦ˆë¥¼ ì´í•´í•˜ê³ , ì´í›„ ëª¨ë“  ê¸°ìˆ  ì§€ì› ë° í´ë ˆì„ ëŒ€ì‘ì˜ ê¸°ì¤€ì ì„ ì„¤ì •í•©ë‹ˆë‹¤.</p>
                    </div>
                    <div class="flex-grow flex flex-col justify-center">
                        <h3 class="text-xl font-bold mb-4 text-center">ğŸš™ í˜„ëŒ€ì œì² ì˜ í•µì‹¬ ê³ ê° í˜ë¥´ì†Œë‚˜ ì •ì˜í•˜ê¸°</h3>
                        <p class="text-sm text-gray-600 mb-8 text-center max-w-2xl mx-auto">ìš°ë¦¬ì™€ í˜‘ì—…í•˜ëŠ” ê³ ê°ì‚¬ì˜ ë‹´ë‹¹ì(ì—”ì§€ë‹ˆì–´, êµ¬ë§¤ ë‹´ë‹¹ì ë“±) íŠ¹ì„±ì„ êµ¬ì²´ì ìœ¼ë¡œ ì…ë ¥í•˜ì—¬ í˜ë¥´ì†Œë‚˜ë¥¼ ì™„ì„±í•˜ê³ , AIë¥¼ í†µí•´ ë§ì¶¤í˜• ëŒ€ì‘ ì „ëµì„ ì–»ì–´ë³´ì„¸ìš”.</p>
                        <div class="bg-gray-50 border border-gray-200 rounded-lg p-6 w-full max-w-3xl mx-auto">
                            <div class="space-y-4 text-sm">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div><label class="font-bold">í˜ë¥´ì†Œë‚˜ ì´ë¦„</label><input type="text" id="p1-name" class="w-full p-2 mt-1 border rounded" placeholder="ì˜ˆ: í˜„ëŒ€ì°¨ ë‚¨ì–‘ì—°êµ¬ì†Œ ë°• ì„ ì„"></div>
                                    <div><label class="font-bold">ì†Œì† / ì§ì±…</label><input type="text" id="p1-info" class="w-full p-2 mt-1 border rounded" placeholder="ì˜ˆ: ì—°êµ¬ê°œë°œë³¸ë¶€ / ì„ ì„ì—°êµ¬ì›"></div>
                                </div>
                                <div><label class="font-bold">ì£¼ìš” ì—…ë¬´ ë° í˜‘ì—… ëª©ì </label><input type="text" id="p1-purpose" class="w-full p-2 mt-1 border rounded" placeholder="ì˜ˆ: ì°¨ì„¸ëŒ€ ê°•íŒ ìŠ¤í™ í˜‘ì˜, ì‹ ì°¨ ì ìš© í…ŒìŠ¤íŠ¸"></div>
                                <div><label class="font-bold">í•µì‹¬ ì„±ê³µ ìš”ì¸ (KPIs)</label><textarea id="p1-goals" class="w-full p-2 mt-1 border rounded" rows="2" placeholder="ì˜ˆ: ëª©í‘œ ê°•ì„± í™•ë³´, ê²½ëŸ‰í™” ë‹¬ì„±, ì•ˆì •ì ì¸ ë‚©ê¸°"></textarea></div>
                                <div><label class="font-bold">ì£¼ìš” ë¶ˆë§Œ ë° ì–´ë ¤ì›€ (Pain Points)</label><textarea id="p1-pain" class="w-full p-2 mt-1 border rounded" rows="2" placeholder="ì˜ˆ: ê¸°ìˆ  ë°ì´í„°ê°€ ë¶€ì¡±í•¨, ìƒ˜í”Œ ëŒ€ì‘ì´ ëŠë¦¼, í´ë ˆì„ ì²˜ë¦¬ê°€ ë¶ˆëª…í™•í•¨"></textarea></div>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div><label class="font-bold">ì£¼ìš” ì†Œí†µ ì±„ë„</label><input type="text" id="p1-channel" class="w-full p-2 mt-1 border rounded" placeholder="ì˜ˆ: ê¸°ìˆ  ë¯¸íŒ…(ëŒ€ë©´), ì´ë©”ì¼, ì •ê¸° êµë¥˜íšŒ"></div>
                                    <div><label class="font-bold">í•µì‹¬ ì„±í–¥ (T/F, J/P)</label><input type="text" id="p1-mbti" class="w-full p-2 mt-1 border rounded" placeholder="ì˜ˆ: T(ë…¼ë¦¬ì¤‘ì‹¬), J(ê³„íšì¤‘ì‹œ)"></div>
                                </div>
                                <div id="m1-validation-error" class="text-red-500 text-sm mt-2 text-center"></div>
                                <button id="persona-generator-btn" class="gemini-button w-full mt-4">âœ¨ AI í˜ë¥´ì†Œë‚˜ ë¶„ì„ ë° ê¸°ìˆ  ëŒ€ì‘ ì „ëµ ì œì•ˆ</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Slide 2: ê³ ê° ê²½í—˜ ì—¬ì •ì§€ë„ (MOT) -->
            <div class="slide">
                <div>
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold">M2: B2B ê³ ê° ì—¬ì • ì§€ë„ (MOT)</h2>
                        <span class="font-bold text-gray-400">2 / 7</span>
                    </div>
                    <div class="learning-objective">
                        <p class="font-bold text-sm">ğŸ’¡ ì˜¤ëŠ˜ì˜ í•™ìŠµ ëª©í‘œ</p>
                        <p class="text-xs text-gray-600">ê³ ê°ì´ ìš°ë¦¬ì™€ í˜‘ì—…í•˜ëŠ” ëª¨ë“  ê³¼ì •ì„ ì‹œê°í™”í•˜ì—¬, ê¸°ìˆ ì /ìš´ì˜ì  ë³‘ëª© ì§€ì ì„ ì°¾ì•„ë‚´ê³  ê°œì„ í•  ê²°ì •ì  ìˆœê°„(MOT)ì„ ì§„ë‹¨í•©ë‹ˆë‹¤.</p>
                    </div>
                    <div id="m2-context" class="context-box hidden"></div>
                    <div class="flex-grow flex flex-col justify-center">
                        <h3 id="journey-title" class="text-xl font-bold mb-4 text-center">ğŸ—ºï¸ ì‘ì „ëª…: ê³ ê° ê²½ë¡œ ì§€ë¢°(Mine)ë¥¼ ì°¾ì•„ë¼!</h3>
                        <p class="text-sm text-gray-600 mb-8 text-center max-w-2xl mx-auto">M1 í˜ë¥´ì†Œë‚˜ê°€ ê²ªëŠ” í˜‘ì—… ì—¬ì •ì„ ë‹¨ê³„ë³„ë¡œ ë¶„ì„í•˜ê³ , 'ë¶ˆë§Œ ì§€ë¢°(Pain Point)'ì™€ 'ì•ˆì „ ì§€ëŒ€(Success Point)'ë¥¼ ì°¾ì•„ë³´ì„¸ìš”.</p>
                        <div class="space-y-4 text-sm max-w-4xl mx-auto w-full">
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div><label class="font-bold">â‘  ì‹ ê·œ ê°œë°œ/ìƒ˜í”Œ ë‹¨ê³„</label><textarea id="j-step1" class="w-full p-2 mt-1 border rounded-md" rows="5" placeholder="[ì ‘ì ] ê¸°ìˆ  ì„¸ë¯¸ë‚˜, ì—°êµ¬ì†Œ ë°©ë¬¸&#10;[ì§€ë¢°(ë¶ˆë§Œ)] ì›í•˜ëŠ” ìŠ¤í™ì˜ ìƒ˜í”Œì´ ì—†ìŒ&#10;[ì§€ë¢°(ë¶ˆë§Œ)] í•´ì™¸ ê²½ìŸì‚¬ ë°ì´í„° ë¶€ì¡±&#10;[ì•ˆì „ì§€ëŒ€(ë§Œì¡±)] ê²½ìŸì‚¬ ë¦¬í¬íŠ¸ê¹Œì§€ ì±™ê²¨ì¤Œ"></textarea></div>
                                <div><label class="font-bold">â‘¡ ì–‘ì‚° ì ìš©/ë‚©í’ˆ ë‹¨ê³„</label><textarea id="j-step2" class="w-full p-2 mt-1 border rounded-md" rows="5" placeholder="[ì ‘ì ] ë°œì£¼ ì‹œìŠ¤í…œ(ERP), SCM ë‹´ë‹¹ì&#10;[ì§€ë¢°(ë¶ˆë§Œ)] ë‚©ê¸°ì¼ì •ì´ ê°‘ìê¸° ë³€ê²½ë¨&#10;[ì§€ë¢°(ë¶ˆë§Œ)] SCMê³¼ ì†Œí†µ ì±„ë„ ë³µì¡&#10;[ì•ˆì „ì§€ëŒ€(ë§Œì¡±)] ìƒì‚° í˜„í™©ì„ ì„ ì œì ìœ¼ë¡œ ê³µìœ í•´ì¤Œ"></textarea></div>
                                <div><label class="font-bold">â‘¢ í’ˆì§ˆ/í´ë ˆì„ ëŒ€ì‘ ë‹¨ê³„</label><textarea id="j-step3" class="w-full p-2 mt-1 border rounded-md" rows="5" placeholder="[ì ‘ì ] í’ˆì§ˆë³´ì¦íŒ€, ê¸°ìˆ  ì„œë¹„ìŠ¤ ë‹´ë‹¹&#10;[ì§€ë¢°(ë¶ˆë§Œ)] í´ë ˆì„ ì›ì¸ ë¶„ì„ì´ ëŠ¦ì–´ì§&#10;[ì§€ë¢°(ë¶ˆë§Œ)] 1ì°¨ ì¡°ì¹˜ê°€ ë¯¸í¡í•¨&#10;[ì•ˆì „ì§€ëŒ€(ë§Œì¡±)] 24ì‹œê°„ ë‚´ í˜„ì¥ ë°©ë¬¸ ë° 1ì°¨ ë³´ê³ ì„œ ì™„ë£Œ"></textarea></div>
                            </div>
                            <div id="m2-validation-error" class="text-red-500 text-sm mt-2 text-center"></div>
                            <button id="journey-mapper-btn" class="gemini-button w-full mt-4">âœ¨ AI ì—¬ì • ë¶„ì„ ë° MOT(ì§€ë¢°) ê°œì„ ì  ì œì•ˆ</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Slide 3: VOC ë¶„ì„ê¸° -->
            <div class="slide">
                <div>
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold">M3: AI ê¸°ìˆ  í´ë ˆì„(VOC) ë¶„ì„ê¸°</h2>
                        <span class="font-bold text-gray-400">3 / 7</span>
                    </div>
                     <div class="learning-objective">
                        <p class="font-bold text-sm">ğŸ’¡ ì˜¤ëŠ˜ì˜ í•™ìŠµ ëª©í‘œ</p>
                        <p class="text-xs text-gray-600">ê³ ê°ì˜ ìƒìƒí•œ ê¸°ìˆ  í´ë ˆì„/ë¬¸ì˜(VOC) ì†ì— ìˆ¨ì–´ìˆëŠ” ì§„ì§œ ì˜ë„ì™€ ì‚¬ì‹¤ê´€ê³„ë¥¼ íŒŒì•…í•˜ê³ , ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ê·¼ë³¸ì ì¸ ê°œì„  í¬ì¸íŠ¸ë¥¼ ë„ì¶œí•©ë‹ˆë‹¤.</p>
                    </div>
                    <div id="m3-context" class="context-box hidden"></div>
                    <div class="flex-grow flex flex-col justify-center">
                        <h3 class="text-xl font-bold mb-4 text-center">ğŸ—£ï¸ ê¸°ìˆ  í´ë ˆì„ì—ì„œ í•µì‹¬ ì´ìŠˆ ë°œê²¬í•˜ê¸°</h3>
                        <p class="text-sm text-gray-600 mb-8 text-center max-w-2xl mx-auto">ê³ ê°ì´ ë‚¨ê¸´ ê¸°ìˆ  ë¬¸ì˜, ë¶ˆë§Œ ë©”ì¼, í´ë ˆì„ ë¦¬í¬íŠ¸ ë“± ì‹¤ì œ VOCë¥¼ ì…ë ¥í•˜ê³  AIë¥¼ í†µí•´ í•µì‹¬ ì´ìŠˆì™€ ê°œì„  í¬ì¸íŠ¸ë¥¼ ì‹ ì†í•˜ê²Œ íŒŒì•…í•˜ì„¸ìš”.</p>
                        <div class="max-w-2xl mx-auto w-full">
                            <label for="voc-input" class="font-bold text-sm">ì‹¤ì œ ê¸°ìˆ  í´ë ˆì„(VOC) ë‚´ìš© ë¶™ì—¬ë„£ê¸°</label>
                            <textarea id="voc-input" class="w-full p-3 mt-1 border rounded-md" rows="8" placeholder="ì˜ˆ: &#10;â€œë°• ì„ ì„ì…ë‹ˆë‹¤. ê¸ˆë²ˆ ë‚©í’ˆëœ ê°•íŒ(HS-120)ì—ì„œ í‘œë©´ ê²°í•¨ì´ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë¼ì¸ ìŠ¤íƒ‘ ì§ì „ì´ë‹ˆ ê¸´ê¸‰ ëŒ€ì‘ ë°”ëë‹ˆë‹¤. ë°ì´í„° ì‹œíŠ¸ ì²¨ë¶€í•©ë‹ˆë‹¤.â€&#10;â€œë‚©ê¸° ì¼ì • ê´€ë ¨í•˜ì—¬ SCMíŒ€ê³¼ ì»¤ë®¤ë‹ˆì¼€ì´ì…˜ì´ ì›í™œí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ë‹´ë‹¹ìë¥¼ ì¼ì›í™”í•´ ì£¼ì‹¤ ìˆ˜ ì—†ì„ê¹Œìš”?â€&#10;â€œê²½ìŸì‚¬ ëŒ€ë¹„ ì„±í˜•ì„± ë°ì´í„°ê°€ ë¶€ì¡±í•˜ì—¬ ë‚´ë¶€ ë³´ê³ ì— ì–´ë ¤ì›€ì´ ìˆìŠµë‹ˆë‹¤.â€"></textarea>
                            <div id="m3-validation-error" class="text-red-500 text-sm mt-2 text-center"></div>
                            <button id="voc-analyzer-btn" class="gemini-button w-full mt-4">âœ¨ AI VOC ë¶„ì„ ë° ê¸´ê¸‰/ì¤‘ì¥ê¸° ê°œì„ ì•ˆ ì œì•ˆ</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Slide 4: CX ì „ëµ ë§Œë“¤ê¸° (SWOT) -->
            <div class="slide">
                <div>
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold">M4: B2B ì„œë¹„ìŠ¤ ì „ëµ ë¶„ì„ (SWOT)</h2>
                        <span class="font-bold text-gray-400">4 / 7</span>
                    </div>
                     <div class="learning-objective">
                        <p class="font-bold text-sm">ğŸ’¡ ì˜¤ëŠ˜ì˜ í•™ìŠµ ëª©í‘œ</p>
                        <p class="text-xs text-gray-600">ìš°ë¦¬ ì„œë¹„ìŠ¤íŒ€ì˜ ê°•ì (S), ì•½ì (W), ê¸°íšŒ(O), ìœ„í˜‘(T)ì„ ë¶„ì„í•˜ì—¬, í•œì •ëœ ìì›ìœ¼ë¡œ ìµœëŒ€ì˜ ê¸°ìˆ  ì„œë¹„ìŠ¤ íš¨ê³¼ë¥¼ ë‚¼ ìˆ˜ ìˆëŠ” ì „ëµ ê³¼ì œì˜ ìš°ì„ ìˆœìœ„ë¥¼ ê²°ì •í•©ë‹ˆë‹¤.</p>
                    </div>
                    <div id="m4-context" class="context-box hidden"></div>
                    <div class="flex-grow flex flex-col justify-center">
                        <h3 id="strategy-title" class="text-xl font-bold mb-4 text-center">ğŸ’¡ ë°ì´í„° ê¸°ë°˜ì˜ ì°¨ë³„í™”ëœ ê¸°ìˆ  ì„œë¹„ìŠ¤ ì „ëµ ìˆ˜ë¦½</h3>
                        <p class="text-sm text-gray-600 mb-8 text-center max-w-2xl mx-auto">ì´ì „ ë¶„ì„ ê²°ê³¼ì™€ ìš°ë¦¬ íŒ€/ê²½ìŸì‚¬ í˜„í™©ì„ ë°”íƒ•ìœ¼ë¡œ, ì‹¤í–‰ ê°€ëŠ¥í•œ ì„œë¹„ìŠ¤ ê°œì„  ê³¼ì œë¥¼ ë„ì¶œí•˜ê³  ìš°ì„ ìˆœìœ„ë¥¼ ì •í•´ë³´ì„¸ìš”.</p>
                        <div class="max-w-3xl mx-auto w-full bg-gray-50 border border-gray-200 rounded-lg p-6 space-y-4 text-sm">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div><label class="font-bold">Strengths (ê°•ì )</label><textarea id="swot-s" class="w-full p-2 mt-1 border rounded-md" rows="2" placeholder="ì˜ˆ: ë†’ì€ ê¸°ìˆ  ì´í•´ë„, ì‹ ì†í•œ í˜„ì¥ ëŒ€ì‘"></textarea></div>
                                <div><label class="font-bold">Weaknesses (ì•½ì )</label><textarea id="swot-w" class="w-full p-2 mt-1 border rounded-md" rows="2" placeholder="ì˜ˆ: í´ë ˆì„ ì²˜ë¦¬ í”„ë¡œì„¸ìŠ¤ ì§€ì—°, SCMê³¼ ì†Œí†µ ì´ìŠˆ"></textarea></div>
                                <div><label class="font-bold">Opportunities (ê¸°íšŒ)</label><textarea id="swot-o" class="w-full p-2 mt-1 border rounded-md" rows="2" placeholder="ì˜ˆ: ê²½ìŸì‚¬ ë‚©ê¸° ì´ìŠˆ ë°œìƒ, ì „ê¸°ì°¨(EV) ì‹ ê·œ ê°•ì¢… ìˆ˜ìš” ì¦ê°€"></textarea></div>
                                <div><label class="font-bold">Threats (ìœ„í˜‘)</label><textarea id="swot-t" class="w-full p-2 mt-1 border rounded-md" rows="2" placeholder="ì˜ˆ: ì¤‘êµ­ì‚° ì €ê°€ ê°•íŒ ê³µì„¸, ì›ìì¬ ê°€ê²© ê¸‰ë“±"></textarea></div>
                            </div>
                            <div>
                                <label class="font-bold">ê²½ìŸì‚¬ ë° ì°¨ë³„ì  ë¶„ì„</label>
                                <textarea id="s-competitor" class="w-full p-2 mt-1 border rounded-md" rows="3" placeholder="ì˜ˆ: Aê²½ìŸì‚¬ëŠ” ê°€ê²©ì´ ì €ë ´í•¨, Bê²½ìŸì‚¬ëŠ” í•´ì™¸ ë„¤íŠ¸ì›Œí¬ê°€ ê°•ì . ìš°ë¦¬ëŠ” 'Total Solution (ê¸°ìˆ +í’ˆì§ˆ+ë‚©ê¸°)'ìœ¼ë¡œ ìŠ¹ë¶€."></textarea>
                            </div>
                            <div id="m4-validation-error" class="text-red-500 text-sm mt-2 text-center"></div>
                            <button id="strategy-generator-btn" class="gemini-button w-full mt-4">âœ¨ AI ì„œë¹„ìŠ¤ ê³¼ì œ ìš°ì„ ìˆœìœ„ ë¶„ì„</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Slide 5: AI ê¸°ìˆ  ìƒë‹´/í´ë ˆì„ ëŒ€ì‘ ìŠ¤í¬ë¦½íŠ¸ -->
            <div class="slide">
                <div>
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold">M5: AI ê¸°ìˆ  ìƒë‹´/í´ë ˆì„ ëŒ€ì‘ ìŠ¤í¬ë¦½íŠ¸</h2>
                        <span class="font-bold text-gray-400">5 / 7</span>
                    </div>
                     <div class="learning-objective">
                        <p class="font-bold text-sm">ğŸ’¡ ì˜¤ëŠ˜ì˜ í•™ìŠµ ëª©í‘œ</p>
                        <p class="text-xs text-gray-600">ë‹¨ìˆœ ìŠ¤í™ ì•ˆë‚´ë¥¼ ë„˜ì–´ ê³ ê°ì‚¬ì˜ ìˆ¨ê²¨ì§„ ë‹ˆì¦ˆ(Unmet Needs)ë¥¼ íŒŒì•…í•˜ê³ , ê¸°ìˆ  í´ë ˆì„ ìƒí™©ì„ ì‹ ë¢°ë¡œ ë°”ê¿€ ìˆ˜ ìˆëŠ” ì „ë¬¸ì ì¸ ì‘ëŒ€ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.</p>
                    </div>
                    <div id="m5-context" class="context-box hidden"></div>
                    <div class="flex-grow flex flex-col justify-center">
                        <h3 class="text-xl font-bold mb-4 text-center">ğŸ’¬ ê³ ê°ì˜ ì‹ ë¢°ë¥¼ ì–»ëŠ” ê¸°ìˆ , ì „ë¬¸ ìŠ¤í¬ë¦½íŠ¸</h3>
                        <p class="text-sm text-gray-600 mb-8 text-center max-w-2xl mx-auto">ì•„ë˜ì— êµ¬ì²´ì ì¸ ìƒë‹´/í´ë ˆì„ ìƒí™©ì„ ì…ë ¥í•˜ê³ , ì´ì „ ë‹¨ê³„ì˜ ë¶„ì„ ê²°ê³¼ë¥¼ ëª¨ë‘ ì¢…í•©í•œ ìµœì ì˜ ì‘ëŒ€ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ìƒì„±í•´ë³´ì„¸ìš”.</p>
                        <div class="max-w-3xl mx-auto w-full bg-gray-50 border border-gray-200 rounded-lg p-6 space-y-4 text-sm">
                            <div>
                                <label class="font-bold">ìƒë‹´ ë˜ëŠ” í´ë ˆì„ ìƒí™©ì„ êµ¬ì²´ì ìœ¼ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”</label>
                                <textarea id="m5-situation" class="w-full p-2 mt-1 border rounded-md" rows="5" placeholder="ì˜ˆ: (í´ë ˆì„ ìƒí™©) í˜„ëŒ€ì°¨ ë°• ì„ ì„ì´ í‘œë©´ ê²°í•¨ìœ¼ë¡œ ê¸´ê¸‰ í´ë ˆì„ì„ ì œê¸°í•¨. ë§¤ìš° í™”ê°€ ë‚œ ìƒíƒœ.&#10;ì˜ˆ: (ê¸°ìˆ  ìƒë‹´ ìƒí™©) ê¸°ì•„ EV í”„ë¡œì íŠ¸ ë‹´ë‹¹ìê°€ ê²½ëŸ‰í™”ë¥¼ ìœ„í•œ ì‹ ê·œ ê°•ì¢…ì„ ë¬¸ì˜í•¨. ì˜ˆì‚°ì— ë¯¼ê°í•¨."></textarea>
                            </div>
                            <div id="m5-validation-error" class="text-red-500 text-sm mt-2 text-center"></div>
                            <button id="m5-script-btn" class="gemini-button w-full mt-4">âœ¨ AI ë§ì¶¤í˜• ì‘ëŒ€ ìŠ¤í¬ë¦½íŠ¸ ìƒì„±</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Slide 6: ì‹¤ì „ ë¡¤í”Œë ˆì´ ì‹œë®¬ë ˆì´ì…˜ -->
            <div class="slide">
                <div>
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold">M6: ì‹¤ì „ ë¡¤í”Œë ˆì´ ì‹œë®¬ë ˆì´ì…˜</h2>
                        <span class="font-bold text-gray-400">6 / 7</span>
                    </div>
                     <div class="learning-objective">
                        <p class="font-bold text-sm">ğŸ’¡ ì˜¤ëŠ˜ì˜ í•™ìŠµ ëª©í‘œ</p>
                        <p class="text-xs text-gray-600">ìƒì„±ëœ ìŠ¤í¬ë¦½íŠ¸ì™€ í˜ë¥´ì†Œë‚˜ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì‹¤ì „ê³¼ ê°™ì€ ë¡¤í”Œë ˆì´ë¥¼ ìˆ˜í–‰í•˜ê³ , ë™ë£Œ/ê°•ì‚¬ì˜ í”¼ë“œë°±ì„ í†µí•´ ìì‹ ì˜ ëŒ€ì‘ ë°©ì‹ì„ ê°ê´€ì ìœ¼ë¡œ ì ê²€í•˜ê³  ê°œì„ í•©ë‹ˆë‹¤.</p>
                    </div>
                    <div class="flex-grow flex flex-col justify-center">
                        <h3 class="text-xl font-bold mb-4 text-center">ğŸ¬ í˜„ì¥ ìƒí™©ì„ ê°€ì •í•œ ì‹¤ì „ ëŒ€ì‘ í›ˆë ¨</h3>
                        <p class="text-sm text-gray-600 mb-8 text-center max-w-2xl mx-auto">M1, M3, M5ì—ì„œ ë„ì¶œí•œ 'í˜ë¥´ì†Œë‚˜', 'í´ë ˆì„ ìƒí™©', 'AI ìŠ¤í¬ë¦½íŠ¸'ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì‹¤ì „ ë¡¤í”Œë ˆì´ë¥¼ ì§„í–‰í•©ë‹ˆë‹¤.</p>
                        <div class="max-w-3xl mx-auto w-full text-sm space-y-4">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div class="bg-gray-50 border rounded-lg p-4">
                                    <h4 class="font-bold mb-2 text-gray-800">ROLE 1: ê³ ê° (í˜ë¥´ì†Œë‚˜)</h4>
                                    <p class="text-xs mb-1">M1/M3ì˜ í˜ë¥´ì†Œë‚˜/VOC ì°¸ê³ </p>
                                    <ul id="m6-role-customer" class="list-disc list-inside text-gray-700 space-y-1 text-xs">
                                        <!-- JS will populate this -->
                                    </ul>
                                </div>
                                <div class="bg-gray-50 border rounded-lg p-4">
                                    <h4 class="font-bold mb-2 text-gray-800">ROLE 2: í˜„ëŒ€ì œì²  ë‹´ë‹¹ì</h4>
                                    <p class="text-xs mb-1">M5ì˜ ìŠ¤í¬ë¦½íŠ¸ ì°¸ê³ </p>
                                    <ul id="m6-role-agent" class="list-disc list-inside text-gray-700 space-y-1 text-xs">
                                        <!-- JS will populate this -->
                                    </ul>
                                </div>
                            </div>
                            <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 text-center">
                                <h4 class="font-bold text-blue-800">ì‹¤í–‰ ê°€ì´ë“œ</h4>
                                <p class="mt-2">1. 2ì¸ 1ì¡°ë¡œ ì—­í• ì„ ë°°ì •í•©ë‹ˆë‹¤. (ê³ ê° vs ë‹´ë‹¹ì)</p>
                                <p class="mt-1">2. 5ë¶„ê°„ ë¡¤í”Œë ˆì´ë¥¼ ì§„í–‰í•˜ê³ , ì¡°ì›ì€ ìŠ¤ë§ˆíŠ¸í°ìœ¼ë¡œ <strong class="text-blue-700">ê³¼ì •ì„ ì´¬ì˜</strong>í•©ë‹ˆë‹¤.</p>
                                <p class="mt-1">3. ì´¬ì˜ëœ ì˜ìƒì„ í•¨ê»˜ ë¦¬ë·°í•˜ë©° <strong class="text-blue-700">ë™ë£Œ í”¼ë“œë°±</strong>ì„ ì§„í–‰í•©ë‹ˆë‹¤.</p>
                            </div>
                            <button id="goto-summary-btn" class="gemini-button w-full mt-4">âœ¨ ëª¨ë“  í›ˆë ¨ ì™„ë£Œ! ìµœì¢… ìš”ì•½ ë³´ëŸ¬ê°€ê¸°</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Slide 7: ìµœì¢… ìš”ì•½ ë° ì •ë¦¬ -->
            <div class="slide">
                 <div>
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold">M7: ìµœì¢… ìš”ì•½ ë° ì•¡ì…˜ í”Œëœ</h2>
                        <span class="font-bold text-gray-400">7 / 7</span>
                    </div>
                     <div class="learning-objective">
                        <p class="font-bold text-sm">ğŸ’¡ ì˜¤ëŠ˜ì˜ í•™ìŠµ ëª©í‘œ</p>
                        <p class="text-xs text-gray-600">ëª¨ë“  í•™ìŠµ ê³¼ì •ì„ ë³µìŠµí•˜ê³  AIì˜ ìµœì¢… ì œì–¸ì„ í†µí•´, ìš°ë¦¬ íŒ€/ê°œì¸ì´ í˜„ì—…ì—ì„œ ì¦‰ì‹œ ì‹¤í–‰í•  ìˆ˜ ìˆëŠ” êµ¬ì²´ì ì¸ ì•¡ì…˜ í”Œëœì„ ìˆ˜ë¦½í•©ë‹ˆë‹¤.</p>
                    </div>
                    <div class="flex-grow flex flex-col justify-center">
                        <h3 class="text-xl font-bold mb-4 text-center">ğŸ“‹ B2B CX ì†”ë£¨ì…˜ ë©: ê²°ê³¼ ë³´ê³ ì„œ</h3>
                        <p class="text-sm text-gray-600 mb-8 text-center max-w-2xl mx-auto">ì§€ê¸ˆê¹Œì§€ ì§„í–‰í•œ ëª¨ë“  ëª¨ë“ˆì˜ ê²°ê³¼ì…ë‹ˆë‹¤. ì•„ë˜ ë²„íŠ¼ì„ ëˆŒëŸ¬ AIì˜ ìµœì¢… ì¢…í•© ë¶„ì„ì„ ë°›ì•„ë³´ì„¸ìš”.</p>
                        <div id="summary-content" class="flex-grow overflow-y-auto p-4 bg-gray-100 rounded-lg border max-h-[400px] space-y-6">
                            <!-- Summary sections will be populated by JS -->
                        </div>
                        <div id="m7-validation-error" class="text-red-500 text-sm mt-2 text-center"></div>
                        <button id="final-report-btn" class="gemini-button w-full mt-6">âœ¨ AI ì¢…í•© ë¶„ì„ ë° ìµœì¢… ì œì–¸ ë°›ê¸°</button>
                    </div>
                </div>
            </div>
            
        </div>

        <!-- Navigation buttons container -->
        <div id="navigation-container" class="flex justify-between items-center mt-8">
            <button id="prev-btn" class="nav-button">â® ì´ì „ ë‹¨ê³„ë¡œ</button>
            <button id="next-btn" class="nav-button">ë‹¤ìŒ ë‹¨ê³„ë¡œ â¯</button>
        </div>
    </main>

    <!-- Gemini Modal -->
    <div id="gemini-modal" 
         class="fixed inset-0 bg-gray-800 bg-opacity-60 overflow-y-auto h-full w-full hidden z-50 flex items-center justify-center p-4"
         role="dialog"
         aria-modal="true"
         aria-labelledby="modal-title">
        <div class="relative mx-auto p-5 border w-full max-w-3xl shadow-lg rounded-xl bg-white">
            <div class="mt-3">
                <div class="flex justify-between items-center mb-4 pb-3 border-b">
                    <h3 id="modal-title" class="text-lg leading-6 font-bold text-gray-900">âœ¨ AI ìƒì„± ê²°ê³¼</h3>
                    <button id="close-modal-button" class="text-gray-400 hover:text-gray-600 text-3xl font-light">&times;</button>
                </div>
                <div id="modal-content" class="mt-2 px-2 py-3 max-h-[60vh] overflow-y-auto">
                    <div id="modal-loader" class="flex justify-center items-center py-10">
                        <div class="spinner"></div>
                        <p class="ml-4 text-gray-600">AIê°€ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤. ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”...</p>
                    </div>
                    <div id="modal-text" class="text-sm text-gray-700 text-left whitespace-pre-wrap leading-relaxed"></div>
                </div>
                <!-- 'classs' typo fixed to 'class' -->
                <div class="flex justify-end items-center px-4 py-3 mt-4 border-t bg-gray-50 rounded-b-xl">
                    <span id="copy-success" class="text-sm text-green-600 mr-4 hidden">ë³µì‚¬ ì™„ë£Œ!</span>
                    <button id="regenerate-button" class="gemini-button text-sm mr-2">âœ¨ ë‹¤ì‹œ ìƒì„±</button>
                    <button id="copy-button" class="bg-gray-200 text-gray-800 font-bold py-2 px-4 rounded-lg hover:bg-gray-300 text-sm">ë‚´ìš© ë³µì‚¬</button>
                </div>
            </div>
        </div>
    </div>
    
    <footer class="text-white text-center py-6 px-4 mt-12">
        <p class="text-sm text-gray-400">&copy; 2025 Hyundai Steel B2B CX Solution Program. All Rights Reserved.</p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // --- 1. DATA STORAGE ---
            const STORAGE_KEY = 'hyundai_steel_cx_lab_data';
            let trainingData = { 
                modulesCompleted: new Set() 
            };
            
            // --- 2. MODULE & SLIDE DEFINITIONS ---
            const moduleTitles = ["í˜ë¥´ì†Œë‚˜", "ê³ ê° ì—¬ì •(MOT)", "í´ë ˆì„(VOC) ë¶„ì„", "SWOT ì „ëµ", "AI ìŠ¤í¬ë¦½íŠ¸", "ì‹¤ì „ ë¡¤í”Œë ˆì´", "ìµœì¢… ìš”ì•½"];
            const slides = document.querySelectorAll('.slide');
            const prevBtn = document.getElementById('prev-btn');
            const nextBtn = document.getElementById('next-btn');
            const progressIndicator = document.getElementById('progress-indicator');
            let currentSlide = 0;

            // --- 3. UTILITY FUNCTIONS ---
            
            /**
             * Debounce function to limit execution rate.
             * @param {Function} func Function to debounce
             * @param {number} wait Wait time in ms
             * @returns {Function} Debounced function
             */
            function debounce(func, wait) {
                let timeout;
                return function executedFunction(...args) {
                    const later = () => {
                        clearTimeout(timeout);
                        func(...args);
                    };
                    clearTimeout(timeout);
                    timeout = setTimeout(later, wait);
                };
            }

            /**
             * Validates input fields.
             * @param {string} value - The value to validate
             * @param {string} fieldName - The user-facing name of the field
             * @param {number} [minLength=5] - The minimum required length
             * @returns {boolean} - True if valid, false otherwise
             */
            function validateInput(value, fieldName, slideId, minLength = 5) {
                const errorDiv = document.getElementById(`m${slideId}-validation-error`);
                if (!errorDiv) return true; // Failsafe

                if (!value || value.trim().length === 0) {
                    errorDiv.textContent = `âŒ ${fieldName}ì„(ë¥¼) ì…ë ¥í•´ì£¼ì„¸ìš”.`;
                    return false;
                }
                if (value.trim().length < minLength) {
                    errorDiv.textContent = `âŒ ${fieldName}ì€(ëŠ”) ìµœì†Œ ${minLength}ì ì´ìƒ ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤.`;
                    return false;
                }
                errorDiv.textContent = '';
                return true;
            }

            /**
             * Clears all validation errors for a slide.
             * @param {string} slideId - The slide number (e.g., '1', '2')
             */
            function clearValidationError(slideId) {
                const errorDiv = document.getElementById(`m${slideId}-validation-error`);
                if (errorDiv) errorDiv.textContent = '';
            }

            /**
             * Sets the loading state for a button.
             * @param {string} buttonId - The ID of the button
             * @param {boolean} isLoading - True to show loading, false to restore
             */
            function setButtonLoading(buttonId, isLoading) {
                const button = document.getElementById(buttonId);
                if (!button) return;

                if (isLoading) {
                    button.disabled = true;
                    button.dataset.originalText = button.innerHTML;
                    button.innerHTML = '<span class="button-spinner"></span>ë¶„ì„ ì¤‘...';
                } else {
                    button.disabled = false;
                    button.innerHTML = button.dataset.originalText;
                }
            }
            
            // --- 4. DATA PERSISTENCE (LocalStorage) ---

            /**
             * Saves the current trainingData to localStorage.
             */
            function saveTrainingData() {
                try {
                    // Update trainingData from all fields before saving
                    // This ensures even non-module-switching changes are captured
                    if (trainingData.persona) {
                        trainingData.persona.name = document.getElementById('p1-name').value;
                        trainingData.persona.info = document.getElementById('p1-info').value;
                        trainingData.persona.purpose = document.getElementById('p1-purpose').value;
                        trainingData.persona.goals = document.getElementById('p1-goals').value;
                        trainingData.persona.pain = document.getElementById('p1-pain').value;
                        trainingData.persona.channel = document.getElementById('p1-channel').value;
                        trainingData.persona.mbti = document.getElementById('p1-mbti').value;
                    }
                    if (trainingData.journey) {
                        trainingData.journey.step1 = document.getElementById('j-step1').value;
                        trainingData.journey.step2 = document.getElementById('j-step2').value;
                        trainingData.journey.step3 = document.getElementById('j-step3').value;
                    }
                    trainingData.vocInput = document.getElementById('voc-input').value;
                    if (trainingData.strategy) {
                         trainingData.strategy.swot_s = document.getElementById('swot-s').value;
                         trainingData.strategy.swot_w = document.getElementById('swot-w').value;
                         trainingData.strategy.swot_o = document.getElementById('swot-o').value;
                         trainingData.strategy.swot_t = document.getElementById('swot-t').value;
                         trainingData.strategy.competitor = document.getElementById('s-competitor').value;
                    }
                    trainingData.scriptSituation = document.getElementById('m5-situation').value;

                    const dataToSave = {
                        ...trainingData,
                        modulesCompleted: Array.from(trainingData.modulesCompleted)
                    };
                    localStorage.setItem(STORAGE_KEY, JSON.stringify(dataToSave));
                } catch (e) {
                    console.error('ë°ì´í„° ì €ì¥ ì‹¤íŒ¨:', e);
                }
            }

            /**
             * Loads and populates trainingData from localStorage.
             * @returns {boolean} - True if data was loaded, false otherwise
             */
            function loadTrainingData() {
                try {
                    const saved = localStorage.getItem(STORAGE_KEY);
                    if (saved) {
                        const parsed = JSON.parse(saved);
                        Object.assign(trainingData, parsed); // Load all data
                        trainingData.modulesCompleted = new Set(parsed.modulesCompleted || []);

                        // Restore UI fields from loaded data
                        if (trainingData.persona) {
                            document.getElementById('p1-name').value = trainingData.persona.name || '';
                            document.getElementById('p1-info').value = trainingData.persona.info || '';
                            document.getElementById('p1-purpose').value = trainingData.persona.purpose || '';
                            document.getElementById('p1-goals').value = trainingData.persona.goals || '';
                            document.getElementById('p1-pain').value = trainingData.persona.pain || '';
                            document.getElementById('p1-channel').value = trainingData.persona.channel || '';
                            document.getElementById('p1-mbti').value = trainingData.persona.mbti || '';
                        }
                        if (trainingData.journey) {
                            document.getElementById('j-step1').value = trainingData.journey.step1 || '';
                            document.getElementById('j-step2').value = trainingData.journey.step2 || '';
                            document.getElementById('j-step3').value = trainingData.journey.step3 || '';
                        }
                        document.getElementById('voc-input').value = trainingData.vocInput || '';
                        if (trainingData.strategy) {
                            document.getElementById('swot-s').value = trainingData.strategy.swot_s || '';
                            document.getElementById('swot-w').value = trainingData.strategy.swot_w || '';
                            document.getElementById('swot-o').value = trainingData.strategy.swot_o || '';
                            document.getElementById('swot-t').value = trainingData.strategy.swot_t || '';
                            document.getElementById('s-competitor').value = trainingData.strategy.competitor || '';
                        }
                        document.getElementById('m5-situation').value = trainingData.scriptSituation || '';
                        
                        return true;
                    }
                } catch (e) {
                    console.error('ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', e);
                    localStorage.removeItem(STORAGE_KEY); // Clear corrupted data
                }
                return false;
            }

            /**
             * Clears all data from localStorage and reloads.
             */
            function clearTrainingData() {
                if (confirm('âš ï¸ ëª¨ë“  í•™ìŠµ ë°ì´í„°ë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) {
                    localStorage.removeItem(STORAGE_KEY);
                    location.reload();
                }
            }

            // --- 5. PROGRESS BAR & SLIDE NAVIGATION ---
            function setupProgressIndicator() {
                progressIndicator.innerHTML = '';
                moduleTitles.forEach((title, index) => {
                    const step = document.createElement('div');
                    step.className = 'step flex flex-col items-center text-center flex-1';
                    step.innerHTML = `<span class="step-circle">${index + 1}</span><span class="step-label">${title}</span>`;
                    progressIndicator.appendChild(step);

                    if (index < moduleTitles.length - 1) {
                        const connector = document.createElement('div');
                        connector.className = 'step-connector';
                        progressIndicator.appendChild(connector);
                    }
                });
            }

            function updateProgressIndicator() {
                const steps = progressIndicator.querySelectorAll('.step');
                steps.forEach((step, i) => {
                    step.classList.remove('active', 'completed');
                    if (i === currentSlide) {
                        step.classList.add('active');
                        step.setAttribute('aria-current', 'step');
                    } else if (trainingData.modulesCompleted.has(i)) {
                        step.classList.add('completed');
                        step.querySelector('.step-circle').innerHTML = 'âœ“';
                        step.removeAttribute('aria-current');
                    } else {
                        step.querySelector('.step-circle').innerHTML = i + 1;
                        step.removeAttribute('aria-current');
                    }
                });
                progressIndicator.setAttribute('aria-valuenow', currentSlide + 1);
            }
            
            // --- 6. CONTEXTUAL DATA PIPELINE ---
            function updateContextualData(index) {
                const contextBoxes = [
                    null, // M1
                    document.getElementById('m2-context'),
                    document.getElementById('m3-context'),
                    document.getElementById('m4-context'),
                    document.getElementById('m5-context'),
                    null, // M6
                    null  // M7
                ];
                
                contextBoxes.forEach(box => box?.classList.add('hidden'));

                if(index > 0 && index < 5) { // Only for slides M2, M3, M4, M5
                    const box = contextBoxes[index];
                    let html = '';
                    let hasContext = false;
                    switch(index) {
                        case 1: // M2 (Journey)
                            if (trainingData.persona?.name) {
                                html = `<p class="font-bold text-sm">M1 ê²°ê³¼ ë¶ˆëŸ¬ì˜¤ê¸°: '${trainingData.persona.name}' í˜ë¥´ì†Œë‚˜</p>
                                        <p class="text-xs mt-1"><strong>ì£¼ìš” ì–´ë ¤ì›€(Pain Point):</strong> ${trainingData.persona.pain || 'N/A'}</p>`;
                                hasContext = true;
                            }
                            break;
                        case 2: // M3 (VOC)
                            if (trainingData.persona?.name) {
                                html = `<p class="font-bold text-sm">CONTEXT: '${trainingData.persona.name}' ê³ ê°ê³¼ ê°™ì€ ë¶„ë“¤ì´ ë‚¨ê²¼ì„ VOCë¥¼ ìƒìƒí•˜ë©° ë¶„ì„í•´ë³´ì„¸ìš”.</p>`;
                                hasContext = true;
                            }
                            break;
                        case 3: // M4 (SWOT)
                            html = '<p class="font-bold text-sm">CONTEXT: ì´ì „ ë‹¨ê³„ ë¶„ì„ ê²°ê³¼ ë¶ˆëŸ¬ì˜¤ê¸°</p><ul class="text-xs list-disc list-inside mt-1 space-y-1">';
                            if (trainingData.persona?.pain) { html += `<li><strong>í˜ë¥´ì†Œë‚˜ í•µì‹¬ ë‹ˆì¦ˆ:</strong> ${trainingData.persona.pain}</li>`; hasContext = true; }
                            if (trainingData.journey?.step1) { html += `<li><strong>ì—¬ì • ì§€ë„ ê°œì„ ì :</strong> '${trainingData.journey.step1.substring(0, 20)}...' ê°œì„  í•„ìš”</li>`; hasContext = true; }
                            if (trainingData.vocInput) { html += `<li><strong>VOC ì…ë ¥ë¨:</strong> "${trainingData.vocInput.substring(0,30)}..."</li>`; hasContext = true; }
                            if (!hasContext) { html = '<li>ì´ì „ ë‹¨ê³„ì˜ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</li>'; }
                            html += '</ul>';
                            hasContext = true;
                            break;
                        case 4: // M5 (Script)
                            html = '<p class="font-bold text-sm">M1~M4 í•µì‹¬ ê²°ê³¼ ë¶ˆëŸ¬ì˜¤ê¸°</p><ul class="text-xs list-disc list-inside mt-1 space-y-1">';
                            if (trainingData.persona?.name) { html += `<li><strong>M1 í˜ë¥´ì†Œë‚˜:</strong> ${trainingData.persona.name} (${trainingData.persona.pain}, ${trainingData.persona.mbti || ''})</li>`; hasContext = true; }
                            if (trainingData.journey?.step1) { html += `<li><strong>M2 MOT(ì§€ë¢°):</strong> '${trainingData.journey.step1.substring(0, 20)}...' ê°œì„  í•„ìš”</li>`; hasContext = true; }
                            if (trainingData.vocInput) { html += `<li><strong>M3 í´ë ˆì„:</strong> "${trainingData.vocInput.substring(0, 25)}..."</li>`; hasContext = true; }
                            if (trainingData.strategy?.swot_s) { html += `<li><strong>M4 ìš°ë¦¬íŒ€ ê°•ì :</strong> ${trainingData.strategy.swot_s}</li>`; hasContext = true; }
                            if (!hasContext) { html = '<p class="font-bold text-sm">ì´ì „ ë‹¨ê³„ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>'; }
                            html += '</ul>';
                            hasContext = true;
                            break;
                    }
                    if(hasContext) {
                        box.innerHTML = html;
                        box.classList.remove('hidden');
                    }
                }
            }
            
            // --- 7. SLIDE DISPLAY LOGIC ---
            function showSlide(index) {
                slides.forEach((slide) => {
                    slide.style.display = 'none';
                });
                slides[index].style.display = 'flex';
                
                prevBtn.disabled = index === 0;
                nextBtn.disabled = index === slides.length - 1;

                updateProgressIndicator();
                updateContextualData(index);

                if (index === 5) { // M6: Roleplay slide
                    const customerRole = document.getElementById('m6-role-customer');
                    const agentRole = document.getElementById('m6-role-agent');
                    
                    let customerHtml = `<li><strong>ê³ ê° í˜ë¥´ì†Œë‚˜:</strong> ${trainingData.persona?.name || 'M1ì—ì„œ ì •ì˜'} (${trainingData.persona?.mbti || 'T/F'})</li>
                                      <li><strong>í´ë ˆì„ ìƒí™©:</strong> ${trainingData.scriptSituation || (trainingData.vocInput?.substring(0, 40) + '...' || 'M3/M5ì—ì„œ ì •ì˜')}</li>
                                      <li><strong>í•µì‹¬ ê°ì •:</strong> ${trainingData.persona?.pain || 'M1ì—ì„œ ì •ì˜'}</li>`;
                    
                    let agentHtml = `<li><strong>ëŒ€ì‘ ëª©í‘œ:</strong> ì‹ ë¢° íšŒë³µ, 1ì°¨ ì¡°ì¹˜ ì œì•ˆ</li>
                                     <li><strong>í•µì‹¬ ìŠ¤í¬ë¦½íŠ¸:</strong> ${trainingData.scriptSituation ? 'M5 ìŠ¤í¬ë¦½íŠ¸ ì°¸ê³ ' : 'M5ì—ì„œ ìƒì„±'}</li>
                                     <li><strong>Must-Do Action:</strong> (ì˜ˆ: 2ì‹œê°„ ë‚´ ë°©ë¬¸ ì•½ì†)</li>`;
                                     
                    customerRole.innerHTML = customerHtml;
                    agentRole.innerHTML = agentHtml;
                }

                if (index === slides.length - 1) { // M7: Summary slide
                    populateSummaryPage();
                }
            }

            nextBtn.addEventListener('click', () => {
                if (currentSlide < slides.length - 1) {
                    trainingData.modulesCompleted.add(currentSlide);
                    currentSlide++;
                    showSlide(currentSlide);
                    saveTrainingData(); // Save progress when moving
                }
            });

            prevBtn.addEventListener('click', () => {
                if (currentSlide > 0) {
                    currentSlide--;
                    showSlide(currentSlide);
                }
            });
            
            document.getElementById('goto-summary-btn')?.addEventListener('click', () => {
                if (currentSlide < slides.length - 1) {
                    trainingData.modulesCompleted.add(currentSlide);
                    currentSlide++;
                    showSlide(currentSlide);
                    saveTrainingData();
                }
            });
            
            // --- 8. SUMMARY PAGE LOGIC ---
            function populateSummaryPage() {
                const summaryContainer = document.getElementById('summary-content');
                let content = '';
                
                const modules = [
                    { title: 'M1: B2B ê³ ê° í˜ë¥´ì†Œë‚˜', data: trainingData.persona, fields: {name: 'ì´ë¦„', info: 'ì†Œì†/ì§ì±…', purpose: 'í˜‘ì—… ëª©ì ', pain: 'ì£¼ìš” ì–´ë ¤ì›€', mbti: 'í•µì‹¬ ì„±í–¥'} },
                    { title: 'M2: B2B ê³ ê° ì—¬ì • (MOT)', data: trainingData.journey, fields: {step1: 'ê°œë°œ/ìƒ˜í”Œ', step2: 'ì–‘ì‚°/ë‚©í’ˆ', step3: 'í’ˆì§ˆ/í´ë ˆì„'} },
                    { title: 'M3: ê¸°ìˆ  í´ë ˆì„(VOC) ë¶„ì„', data: trainingData, fields: {vocInput: 'ì…ë ¥ëœ VOC'} },
                    { title: 'M4: B2B ì„œë¹„ìŠ¤ ì „ëµ (SWOT)', data: trainingData.strategy, fields: {swot_s: 'ê°•ì ', swot_w: 'ì•½ì ', swot_o: 'ê¸°íšŒ', swot_t: 'ìœ„í˜‘', competitor: 'ê²½ìŸì‚¬ ë¶„ì„'} },
                    { title: 'M5: AI ì‘ëŒ€ ìŠ¤í¬ë¦½íŠ¸', data: trainingData, fields: {scriptSituation: 'ì…ë ¥ëœ ìƒí™©'} }
                ];

                modules.forEach(module => {
                    content += `<div class="p-4 bg-white rounded-lg shadow-sm"><h4 class="font-bold text-base mb-2 text-gray-800">${module.title}</h4>`;
                    let hasData = module.data && Object.keys(module.fields).some(field => module.data[field]);
                    
                    if (hasData) {
                        content += '<div class="text-sm space-y-1 text-gray-600">';
                        for (const [field, label] of Object.entries(module.fields)) {
                             if(module.data[field]) {
                                 content += `<p class="whitespace-pre-wrap"><strong>${label}:</strong> ${module.data[field]}</p>`;
                             }
                        }
                        content += '</div>';
                    } else {
                        content += '<p class="text-sm text-gray-500">ì•„ì§ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                    }
                    content += '</div>';
                });
                
                summaryContainer.innerHTML = content;
            }
            
            // --- 9. MODAL & API CALL LOGIC ---
            const modal = document.getElementById('gemini-modal');
            const modalTitle = document.getElementById('modal-title');
            const modalLoader = document.getElementById('modal-loader');
            const modalText = document.getElementById('modal-text');
            const closeModalButton = document.getElementById('close-modal-button');
            const regenerateButton = document.getElementById('regenerate-button');
            const copyButton = document.getElementById('copy-button');
            const copySuccessMessage = document.getElementById('copy-success');

            let lastPrompt = ''; // For re-generation

            const openModal = () => {
                 modal.classList.remove('hidden');
                 modal.setAttribute('aria-hidden', 'false');
                 closeModalButton.focus();
            };
            const closeModal = () => {
                modal.classList.add('hidden');
                modal.setAttribute('aria-hidden', 'true');
            };

            closeModalButton.addEventListener('click', closeModal);
            modal.addEventListener('click', (e) => {
                if (e.target === modal) closeModal();
            });

            /**
             * Formats the raw model output text into structured HTML.
             * @param {string} text - Raw text from the API
             * @returns {string} - Formatted HTML
             */
            function formatResponse(text) {
                let html = text.trim();
                
                // 1. Convert headers (e.g., #, ##, 1. **, 2. **)
                html = html.replace(/^(#+)\s*(.*?)($|\r\n|\r|\n)/gm, '<h4 class="font-bold text-base text-gray-900 mt-4 mb-2">$2</h4>');
                html = html.replace(/^[0-9]+\.\s*\*\*(.*?)\*\*[:\s]*($|\r\n|\r|\n)/gm, '<h4 class="font-bold text-base text-gray-900 mt-4 mb-2">$1</h4>');
                html = html.replace(/^\*\*(.*?)\*\*[:\s]*($|\r\n|\r|\n)/gm, '<h4 class="font-bold text-base text-gray-900 mt-4 mb-2">$1</h4>');

                // 2. Convert bolding
                html = html.replace(/\*\*(.*?)\*\*/g, '<strong class="font-bold text-gray-900">$1</strong>');
                
                // 3. Convert list items (* or -)
                html = html.replace(/((?:^[ \t]*[\*\-]\s+.*(?:\r\n|\r|\n)?)+)/gm, (match) => {
                    let listItems = match.replace(/^[ \t]*[\*\-]\s+(.*)$/gm, '<li>$1</li>');
                    return '<ul class="list-disc list-outside ml-5 space-y-1">' + listItems.trim() + '</ul>';
                });

                // 4. Convert paragraphs
                html = html.split(/(?:\r\n|\r|\n){2,}/)
                           .map(paragraph => {
                               let trimmed = paragraph.trim();
                               if (trimmed.startsWith('<h4') || trimmed.startsWith('<ul') || trimmed.length === 0) {
                                   return trimmed; 
                               }
                               return '<p class="mb-2">' + trimmed.replace(/(?:\r\n|\r|\n)/g, '<br>') + '</p>';
                           })
                           .join('');

                // 5. Clean up
                html = html.replace(/<p class="mb-2"><\/p>/g, '');
                html = html.replace(/<br>\s*<br>/g, '<br>');

                return html;
            }

            /**
             * Main function to open modal and call API.
             * @param {string} prompt - The prompt to send to the API
             * @param {string} title - The title for the modal
             * @param {string} buttonId - The ID of the button that triggered this
             */
            async function generateContent(prompt, title, buttonId) {
                lastPrompt = prompt;
                modalTitle.textContent = title;
                modalText.innerHTML = '';
                modalLoader.style.display = 'flex';
                copySuccessMessage.classList.add('hidden');
                openModal();
                
                if (buttonId) setButtonLoading(buttonId, true);
                
                let errorText = null;
                
                try {
                    // API Key is intentionally left blank.
                    const apiKey = ""; // Do not insert API key here.
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
                    
                    const payload = { 
                        contents: [{ parts: [{ text: prompt }] }],
                        tools: [{ "google_search": {} }] // Google Search enabled
                    };

                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        // Handle HTTP errors
                        let errorMsg = `HTTP ì˜¤ë¥˜: ${response.status}`;
                        if (response.status === 429) {
                            errorMsg = "âš ï¸ API ìš”ì²­ í•œë„ë¥¼ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.";
                        } else if (response.status === 401 || response.status === 403) {
                            errorMsg = "âš ï¸ API ì¸ì¦ì— ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•´ ì£¼ì„¸ìš”.";
                        } else {
                            try {
                                const errData = await response.json();
                                errorMsg = `âš ï¸ API ì˜¤ë¥˜ (${response.status}): ${errData.error?.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'}`;
                            } catch (e) { /* ignore */ }
                        }
                        throw new Error(errorMsg);
                    }
                    
                    const result = await response.json();
                    
                    // Validate API response structure
                    const text = result.candidates?.[0]?.content?.parts?.[0]?.text;
                    if (!text) {
                        throw new Error("API ì‘ë‹µ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.");
                    }

                    modalText.innerHTML = formatResponse(text);

                } catch (error) {
                    console.error("API call failed:", error);
                    // Do not log retries to console
                    errorText = error.message || "ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ í™•ì¸í•˜ê±°ë‚˜ ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.";
                } finally {
                    if (buttonId) setButtonLoading(buttonId, false);
                    modalLoader.style.display = 'none';
                    if (errorText) {
                        modalText.innerHTML = `<p class="text-red-600 font-bold text-center p-4">${errorText}</p>`;
                    }
                }
            }
            
            regenerateButton.addEventListener('click', () => {
                if (lastPrompt) {
                    // Find which button was the last one
                    const buttonId = document.querySelector('button[disabled][data-original-text]')?.id;
                    generateContent(lastPrompt, modalTitle.textContent, buttonId);
                }
            });

            copyButton.addEventListener('click', () => {
                const textToCopy = modalText.innerText;
                try {
                    const tempTextarea = document.createElement('textarea');
                    tempTextarea.value = textToCopy;
                    document.body.appendChild(tempTextarea);
                    tempTextarea.select();
                    document.execCommand('copy');
                    document.body.removeChild(tempTextarea);
                    
                    copySuccessMessage.classList.remove('hidden');
                    setTimeout(() => copySuccessMessage.classList.add('hidden'), 2000);
                } catch (err) {
                    console.error('Failed to copy text: ', err);
                }
            });
            
            // --- 10. PROMPT TEMPLATES ---
            
            // [ìˆ˜ì •] í…Œì´ë¸” ì¶œë ¥ì„ ê¸ˆì§€í•˜ê³  ê°œì¡°ì‹ ì¶œë ¥ì„ ê°•ì œí•˜ëŠ” ê¸°ë³¸ ì œì•½ ì¡°ê±´
            const baseConstraints = `
# ì œì•½ ì¡°ê±´
- ì¶œë ¥ í˜•ì‹(ê°œì¡°ì‹)ì„ ë°˜ë“œì‹œ ì¤€ìˆ˜í•  ê²ƒ.
- ì ˆëŒ€ë¡œ ë§ˆí¬ë‹¤ìš´ í…Œì´ë¸”(|)ì„ ì‚¬ìš©í•˜ì§€ ë§ ê²ƒ.
- ëª¨ë“  ì œì•ˆì€ êµ¬ì¡°í™”ëœ ë¦¬ìŠ¤íŠ¸(ì˜ˆ: 1. í•­ëª©, - ì„¸ë¶€ í•­ëª©)ë¡œ ì œê³µí•  ê²ƒ.`;

            const promptTemplates = {
                persona: (data) => `ë‹¹ì‹ ì€ 'í˜„ëŒ€ì œì² ' B2B CX ì»¨ì„¤í„´íŠ¸ì…ë‹ˆë‹¤.
# ì—­í•  ë° ëª©í‘œ
B2B ê³ ê° í˜ë¥´ì†Œë‚˜ë¥¼ ì‹¬ì¸µ ë¶„ì„í•˜ê³ , ê¸°ìˆ  ì„œë¹„ìŠ¤ ëŒ€ì‘ ì „ëµì„ ìˆ˜ë¦½í•©ë‹ˆë‹¤.

# ì…ë ¥ ë°ì´í„°
- ì´ë¦„/ì†Œì†: ${data.name} (${data.info})
- ì£¼ìš” ì—…ë¬´: ${data.purpose}
- KPI: ${data.goals}
- Pain Points: ${data.pain}
- ì†Œí†µ ì±„ë„: ${data.channel}
- MBTI ì„±í–¥: ${data.mbti}

# ì¶œë ¥ í˜•ì‹ (ë°˜ë“œì‹œ ì¤€ìˆ˜)
## 1. í˜ë¥´ì†Œë‚˜ ì‹¬ì¸µ ë¶„ì„
- **ê°ì • ìƒíƒœ**: [ë¶„ì„ ë‚´ìš©]
- **ìˆ¨ê²¨ì§„ ë‹ˆì¦ˆ**: [ë¶„ì„ ë‚´ìš©]
- **ì˜ì‚¬ê²°ì • ìŠ¤íƒ€ì¼** (${data.mbti} ê¸°ë°˜): [ë¶„ì„ ë‚´ìš©]

## 2. ë§ì¶¤í˜• ê¸°ìˆ  ì§€ì› ì „ëµ
### ì „ëµ 1: [ì „ëµëª…]
- **ì‹¤í–‰ ë°©ì•ˆ**: [êµ¬ì²´ì  í–‰ë™]
- **ê¸°ëŒ€ íš¨ê³¼**: [íš¨ê³¼]
### ì „ëµ 2: [ì „ëµëª…]
- **ì‹¤í–‰ ë°©ì•ˆ**: [êµ¬ì²´ì  í–‰ë™]
- **ê¸°ëŒ€ íš¨ê³¼**: [íš¨ê³¼]
### ì „ëµ 3: [ì „ëµëª…]
- **ì‹¤í–‰ ë°©ì•ˆ**: [êµ¬ì²´ì  í–‰ë™]
- **ê¸°ëŒ€ íš¨ê³¼**: [íš¨ê³¼]

${baseConstraints}
- ${data.mbti} ì„±í–¥ì„ ë°˜ë“œì‹œ ê³ ë ¤
- í˜„ëŒ€ì œì² ì˜ B2B ê¸°ìˆ  ì„œë¹„ìŠ¤ ë§¥ë½ì— ì í•©í•´ì•¼ í•¨`,
                
                journey: (data, persona) => `ë‹¹ì‹ ì€ 'í˜„ëŒ€ì œì² ' CX ë””ìì´ë„ˆì…ë‹ˆë‹¤.
# ì—­í•  ë° ëª©í‘œ
B2B ê³ ê° ì—¬ì • ì§€ë„ë¥¼ ë¶„ì„í•˜ì—¬, ë‹¨ê³„ë³„ 'ë¶ˆë§Œ ì§€ë¢°(Pain Point)'ë¥¼ ëª…í™•íˆ ì§„ë‹¨í•˜ê³ , 'ì•ˆì „ ì§€ëŒ€(Success Point)'ë¡œ ë°”ê¿€ MOT ê°œì„  ì•„ì´ë””ì–´ë¥¼ ì œì•ˆí•©ë‹ˆë‹¤.
${persona ? `\n# ì»¨í…ìŠ¤íŠ¸\n- M1ì˜ '${persona.name}' í˜ë¥´ì†Œë‚˜ ì—¬ì •ì´ë¼ê³  ê°€ì •.` : ''}

# B2B ê³ ê° ì—¬ì • ì§€ë„
- **ê°œë°œ/ìƒ˜í”Œ**: ${data.step1}
- **ì–‘ì‚°/ë‚©í’ˆ**: ${data.step2}
- **í’ˆì§ˆ/í´ë ˆì„**: ${data.step3}

# ì¶œë ¥ í˜•ì‹ (ë°˜ë“œì‹œ ì¤€ìˆ˜)
## 1. í•µì‹¬ 'ì§€ë¢°'(Pain Point) ì§„ë‹¨
- **ê°œë°œ/ìƒ˜í”Œ ë‹¨ê³„**: [ì§„ë‹¨ ë‚´ìš©]
- **ì–‘ì‚°/ë‚©í’ˆ ë‹¨ê³„**: [ì§„ë‹¨ ë‚´ìš©]
- **í’ˆì§ˆ/í´ë ˆì„ ë‹¨ê³„**: [ì§„ë‹¨ ë‚´ìš©]

## 2. MOT ê°œì„  ì•„ì´ë””ì–´ (Top 3)
### ì•„ì´ë””ì–´ 1: [ì•„ì´ë””ì–´ëª…]
- **ê°œì„  ëŒ€ìƒ**: [ì˜ˆ: ê°œë°œ/ìƒ˜í”Œ ë‹¨ê³„ì˜ ë°ì´í„° ë¶€ì¡± ì§€ë¢°]
- **ì‹¤í–‰ ë°©ì•ˆ**: [êµ¬ì²´ì  ë°©ì•ˆ]
- **ê¸°ëŒ€ íš¨ê³¼**: [íš¨ê³¼]
### ì•„ì´ë””ì–´ 2: [ì•„ì´ë””ì–´ëª…]
- **ê°œì„  ëŒ€ìƒ**: [ê°œì„  ëŒ€ìƒ]
- **ì‹¤í–‰ ë°©ì•ˆ**: [êµ¬ì²´ì  ë°©ì•ˆ]
- **ê¸°ëŒ€ íš¨ê³¼**: [íš¨ê³¼]
### ì•„ì´ë””ì–´ 3: [ì•„ì´ë””ì–´ëª…]
- **ê°œì„  ëŒ€ìƒ**: [ê°œì„  ëŒ€ìƒ]
- **ì‹¤í–‰ ë°©ì•ˆ**: [êµ¬ì²´ì  ë°©ì•ˆ]
- **ê¸°ëŒ€ íš¨ê³¼**: [íš¨ê³¼]

${baseConstraints}`,

                voc: (data) => `ë‹¹ì‹ ì€ 'í˜„ëŒ€ì œì² 'ì˜ ë² í…Œë‘ í’ˆì§ˆ ê´€ë¦¬(QC) ë° ê¸°ìˆ  ì„œë¹„ìŠ¤ ì „ë¬¸ê°€ì…ë‹ˆë‹¤.
# ì—­í•  ë° ëª©í‘œ
ì•„ë˜ ê¸°ìˆ  í´ë ˆì„(VOC) ë‚´ìš©ì„ ë¶„ì„í•˜ì—¬ ì²´ê³„ì ìœ¼ë¡œ ì •ë¦¬í•˜ê³ , ì‹¤í–‰ ê°€ëŠ¥í•œ ê°œì„  ë°©ì•ˆì„ ì œì•ˆí•©ë‹ˆë‹¤.

# ê³ ê° ê¸°ìˆ  í´ë ˆì„(VOC) ì›ë¬¸
${data}

# ì¶œë ¥ í˜•ì‹ (ë°˜ë“œì‹œ ì¤€ìˆ˜)
## 1. VOC ìš”ì•½ ë° ê¸´ê¸‰ë„
- **ìš”ì•½**: [í•œ ë¬¸ì¥ ìš”ì•½]
- **ê¸´ê¸‰ë„**: [High/Mid/Low ì¤‘ íƒ1 ë° ì´ìœ ]

## 2. ê´€ë ¨ ë¶€ì„œ ì‹ë³„
- [ì˜ˆ: ê¸°ìˆ , í’ˆì§ˆ, SCM, ì˜ì—… ë“±]

## 3. ê³ ê° í•µì‹¬ ë‹ˆì¦ˆ ë° ê·¼ë³¸ ì›ì¸(RCA) ì¶”ë¡ 
- **ê³ ê° ë‹ˆì¦ˆ**: [ê³ ê°ì˜ ì§„ì§œ ìš”êµ¬ì‚¬í•­]
- **ê·¼ë³¸ ì›ì¸**: [ì¶”ë¡ ëœ ë¬¸ì œì˜ ê·¼ë³¸ ì›ì¸]

## 4. Action Item ì œì•ˆ
- **ë‹¨ê¸° ê¸´ê¸‰ì¡°ì¹˜**: [ì¦‰ì‹œ ì‹¤í–‰í•  í–‰ë™ 1], [í–‰ë™ 2]
- **ì¤‘ì¥ê¸° ì¬ë°œë°©ì§€**: [í”„ë¡œì„¸ìŠ¤/ì‹œìŠ¤í…œ ê°œì„  ë°©ì•ˆ 1], [ë°©ì•ˆ 2]

${baseConstraints}`,
                
                strategy: (data, context) => `ë‹¹ì‹ ì€ 'í˜„ëŒ€ì œì² ' ê¸°ìˆ  ì„œë¹„ìŠ¤ ì „ëµê°€ì…ë‹ˆë‹¤.
# ì—­í•  ë° ëª©í‘œ
ì•„ë˜ ë°ì´í„°ë¥¼ ë°”íƒ•ìœ¼ë¡œ, ìš°ë¦¬ íŒ€ì´ ì‹¤í–‰ ê°€ëŠ¥í•œ ì„œë¹„ìŠ¤ ê°œì„  ê³¼ì œë¥¼ ë„ì¶œí•˜ê³  ìš°ì„ ìˆœìœ„ë¥¼ ì •í•©ë‹ˆë‹¤.

# ì¢…í•© ì»¨í…ìŠ¤íŠ¸
${context}

# ìš°ë¦¬ íŒ€ SWOT ë° ê²½ìŸì‚¬ ë¶„ì„
${JSON.stringify(data, null, 2)}

# ì¶œë ¥ í˜•ì‹ (ë°˜ë“œì‹œ ì¤€ìˆ˜)
## 1. ì„œë¹„ìŠ¤ ê°œì„  ê³¼ì œ (Top 5)
- **ê³¼ì œ 1**: [ê³¼ì œ ë‚´ìš©]
- **ê³¼ì œ 2**: [ê³¼ì œ ë‚´ìš©]
- **ê³¼ì œ 3**: [ê³¼ì œ ë‚´ìš©]
- **ê³¼ì œ 4**: [ê³¼ì œ ë‚´ìš©]
- **ê³¼ì œ 5**: [ê³¼ì œ ë‚´ìš©]

## 2. ê³¼ì œ ìš°ì„ ìˆœìœ„ í‰ê°€ (ICE í”„ë ˆì„ì›Œí¬)
- **ê³¼ì œ 1**: (Impact: [ìƒ/ì¤‘/í•˜], Confidence: [ìƒ/ì¤‘/í•˜], Ease: [ìƒ/ì¤‘/í•˜])
- **ê³¼ì œ 2**: (Impact: [ìƒ/ì¤‘/í•˜], Confidence: [ìƒ/ì¤‘/í•˜], Ease: [ìƒ/ì¤‘/í•˜])
- **ê³¼ì œ 3**: (Impact: [ìƒ/ì¤‘/í•˜], Confidence: [ìƒ/ì¤‘/í•˜], Ease: [ìƒ/ì¤‘/í•˜])

## 3. 1ìˆœìœ„ í•µì‹¬ ê³¼ì œ ë° ì‹¤í–‰ ì´ìœ 
- **1ìˆœìœ„ ê³¼ì œ**: [ì„ ì •ëœ 1ìˆœìœ„ ê³¼ì œëª…]
- **ì„ ì • ì´ìœ **: [ì„ ì • ì´ìœ ]

${baseConstraints}`,
                
                script: (data, context) => `ë‹¹ì‹ ì€ 'í˜„ëŒ€ì œì² 'ì˜ ìµœê³  ê¸°ìˆ  ì˜ì—… ë° í´ë ˆì„ ëŒ€ì‘ ì „ë¬¸ê°€(ACE)ì…ë‹ˆë‹¤.
# ì—­í•  ë° ëª©í‘œ
ì•„ë˜ì˜ ì¢…í•© ë°ì´í„°ì™€ êµ¬ì²´ì ì¸ ìƒë‹´/í´ë ˆì„ ìƒí™©ì„ ë°”íƒ•ìœ¼ë¡œ, ê³ ê°ì„ ì•ˆì‹¬ì‹œí‚¤ê³  ì‹ ë¢°ë¥¼ êµ¬ì¶•í•  ìˆ˜ ìˆëŠ” ì´ìƒì ì¸ ì‘ëŒ€ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‘ì„±í•©ë‹ˆë‹¤. (íŠ¹íˆ ê³ ê° í˜ë¥´ì†Œë‚˜ì˜ 'í•µì‹¬ ì„±í–¥(T/F, J/P)'ì„ ë°˜ë“œì‹œ ë°˜ì˜)

# ì¢…í•© ì»¨í…ìŠ¤íŠ¸
${context}
- **í˜„ì¬ ìƒë‹´/í´ë ˆì„ ìƒí™©**: ${data}

# ì¶œë ¥ í˜•ì‹ (ë°˜ë“œì‹œ ì¤€ìˆ˜)
## 1. ìƒí™© ìš”ì•½ ë° ëŒ€ì‘ ëª©í‘œ
- **ìƒí™© ì§„ë‹¨**: [í˜„ì¬ ìƒí™© ìš”ì•½]
- **ê³ ê° ì„±í–¥**: [í˜ë¥´ì†Œë‚˜ ê¸°ë°˜ ì„±í–¥ ë¶„ì„]
- **ëŒ€ì‘ ëª©í‘œ**: [ì˜ˆ: ê³ ê° ê°ì • ì§„ì •, 1ì°¨ ì¡°ì¹˜ ì œì•ˆ, ì‹ ë¢° íšŒë³µ]

## 2. ë§ì¶¤í˜• ì‘ëŒ€ ìŠ¤í¬ë¦½íŠ¸ (4ë‹¨ê³„)
### 1ë‹¨ê³„: ê³µê° ë° ê²½ì²­
- **ì§ì›**: [ë©˜íŠ¸]
### 2ë‹¨ê³„: ì‚¬ì‹¤ í™•ì¸ ë° ì§ˆë¬¸
- **ì§ì›**: [ë©˜íŠ¸]
- **ê³ ê°**: [ì˜ˆìƒ ë‹µë³€]
### 3ë‹¨ê³„: 1ì°¨ í•´ê²°ì±… ì œì‹œ
- **ì§ì›**: [ë©˜íŠ¸]
### 4ë‹¨ê³„: í–¥í›„ ê³„íš ë° ì‹ ë¢° êµ¬ì¶•
- **ì§ì›**: [ë©˜íŠ¸]

## 3. ìƒí™©ë³„ 'Must-Do Action'
- [ì˜ˆ: 2ì‹œê°„ ë‚´ í˜„ì¥ ë°©ë¬¸ ì•½ì†, ìœ ê´€ë¶€ì„œ(í’ˆì§ˆ) ì¦‰ì‹œ ì•Œë¦¼]

${baseConstraints}`,

                finalReport: (data) => `ë‹¹ì‹ ì€ 'í˜„ëŒ€ì œì² 'ì˜ ìˆ˜ì„ B2B CX ì»¨ì„¤í„´íŠ¸ì…ë‹ˆë‹¤.
# ì—­í•  ë° ëª©í‘œ
ì•„ë˜ ì›Œí¬ìƒµ ê²°ê³¼ ë°ì´í„°ë¥¼ ì¢…í•© ë¶„ì„í•˜ì—¬, ì„œë¹„ìŠ¤íŒ€ì´ ì‹¤í–‰í•  ìµœì¢… ì „ëµê³¼ ì•¡ì…˜ í”Œëœì„ ë‹´ì€ ë³´ê³ ì„œë¥¼ ì‘ì„±í•©ë‹ˆë‹¤.

# ì›Œí¬ìƒµ ì¢…í•© ë°ì´í„°
- **M1 í˜ë¥´ì†Œë‚˜**: ${JSON.stringify(data.persona, null, 2)}
- **M2 ê³ ê° ì—¬ì •(MOT)**: ${JSON.stringify(data.journey, null, 2)}
- **M3 í´ë ˆì„(VOC)**: ${data.vocInput || "ì…ë ¥ë˜ì§€ ì•ŠìŒ"}
- **M4 SWOT**: ${JSON.stringify(data.strategy, null, 2)}
- **M5 ìŠ¤í¬ë¦½íŠ¸ ìƒí™©**: ${data.scriptSituation || "ì…ë ¥ë˜ì§€ ì•ŠìŒ"}

# ì¶œë ¥ í˜•ì‹ (ë°˜ë“œì‹œ ì¤€ìˆ˜)
## 1. í˜„í™© ì§„ë‹¨ (ìš”ì•½)
- [ìˆ˜ì§‘ëœ ëª¨ë“  ë°ì´í„°ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì´ ì„œë¹„ìŠ¤íŒ€ì˜ CX í˜„ì£¼ì†Œë¥¼ í•œ ë¬¸ë‹¨ìœ¼ë¡œ ìš”ì•½ ì§„ë‹¨ (ê°•ì ê³¼ ì‹œê¸‰í•œ 'ì§€ë¢°' í¬í•¨)]

## 2. í•µì‹¬ ì „ëµ ë°©í–¥
- **ë°©í–¥ 1**: [ê°€ì¥ ì¤‘ìš”í•œ ì „ëµ ë°©í–¥ 1]
- **ë°©í–¥ 2**: [ë‘ ë²ˆì§¸ë¡œ ì¤‘ìš”í•œ ì „ëµ ë°©í–¥ 2]

## 3. í†µí•© ì•¡ì…˜ í”Œëœ (Top 3)
### 1ìˆœìœ„: [ê³¼ì œëª…]
- **ì‹¤í–‰ ë°©ì•ˆ**: [êµ¬ì²´ì ì¸ ì‹¤í–‰ ë°©ì•ˆ]
- **ë‹´ë‹¹**: [ì¶”ì²œ ë‹´ë‹¹ (ì˜ˆ: ê°œì¸, íŒ€ ë¦¬ë”)]
### 2ìˆœìœ„: [ê³¼ì œëª…]
- **ì‹¤í–‰ ë°©ì•ˆ**: [êµ¬ì²´ì ì¸ ì‹¤í–‰ ë°©ì•ˆ]
- **ë‹´ë‹¹**: [ì¶”ì²œ ë‹´ë‹¹]
### 3ìˆœìœ„: [ê³¼ì œëª…]
- **ì‹¤í–‰ ë°©ì•ˆ**: [êµ¬ì²´ì ì¸ ì‹¤í–‰ ë°©ì•ˆ]
- **ë‹´ë‹¹**: [ì¶”ì²œ ë‹´ë‹¹]

## 4. ê¸°ëŒ€íš¨ê³¼ ë° ì œì–¸
- [ì œì•ˆëœ ì „ëµ ì‹¤í–‰ ì‹œ ê¸°ëŒ€í•  ìˆ˜ ìˆëŠ” íš¨ê³¼ë¥¼ ì„¤ëª…í•˜ê³ , ì„œë¹„ìŠ¤íŒ€ êµ¬ì„±ì›ë“¤ì—ê²Œ ë™ê¸°ë¥¼ ë¶€ì—¬í•˜ëŠ” ë©”ì‹œì§€]

${baseConstraints}`
            };

            // --- 11. BUTTON EVENT LISTENERS PER SLIDE ---

            // Slide 1: Persona
            document.getElementById('persona-generator-btn')?.addEventListener('click', () => {
                clearValidationError('1');
                const name = document.getElementById('p1-name').value;
                const info = document.getElementById('p1-info').value;
                const pain = document.getElementById('p1-pain').value;

                if (!validateInput(name, 'í˜ë¥´ì†Œë‚˜ ì´ë¦„', '1', 2)) return;
                if (!validateInput(info, 'ì†Œì†/ì§ì±…', '1', 3)) return;
                if (!validateInput(pain, 'ì£¼ìš” ì–´ë ¤ì›€', '1', 10)) return;
                
                trainingData.persona = {
                    name, info,
                    purpose: document.getElementById('p1-purpose').value,
                    goals: document.getElementById('p1-goals').value,
                    pain, 
                    channel: document.getElementById('p1-channel').value,
                    mbti: document.getElementById('p1-mbti').value
                };
                
                const prompt = promptTemplates.persona(trainingData.persona);
                generateContent(prompt, `'${trainingData.persona.name}' í˜ë¥´ì†Œë‚˜ ë¶„ì„`, 'persona-generator-btn');
                document.getElementById('journey-title').textContent = `ğŸ—ºï¸ '${trainingData.persona.name}'ë‹˜ì˜ ì—¬ì • ì§€ë„ ë§Œë“¤ê¸°`;
                saveTrainingData();
            });
            
            // Slide 2: Journey
            document.getElementById('journey-mapper-btn')?.addEventListener('click', () => {
                clearValidationError('2');
                const step1 = document.getElementById('j-step1').value;
                if (!validateInput(step1, 'ì‹ ê·œ ê°œë°œ/ìƒ˜í”Œ ë‹¨ê³„', '2', 10)) return;

                trainingData.journey = { 
                    step1, 
                    step2: document.getElementById('j-step2').value, 
                    step3: document.getElementById('j-step3').value 
                };
                
                const prompt = promptTemplates.journey(trainingData.journey, trainingData.persona);
                generateContent(prompt, `B2B ê³ ê° ì—¬ì • ì§€ë„ ë¶„ì„`, 'journey-mapper-btn');
                saveTrainingData();
            });

            // Slide 3: VOC
            document.getElementById('voc-analyzer-btn')?.addEventListener('click', () => {
                clearValidationError('3');
                const vocInput = document.getElementById('voc-input').value;
                if (!validateInput(vocInput, 'VOC ë‚´ìš©', '3', 15)) return;

                trainingData.vocInput = vocInput;
                const prompt = promptTemplates.voc(trainingData.vocInput);
                generateContent(prompt, `AI ê¸°ìˆ  í´ë ˆì„(VOC) ì‹¬ì¸µ ë¶„ì„`, 'voc-analyzer-btn');
                saveTrainingData();
            });
            
            // Slide 4: Strategy
            document.getElementById('strategy-generator-btn')?.addEventListener('click', () => {
                clearValidationError('4');
                const swot_s = document.getElementById('swot-s').value;
                if (!validateInput(swot_s, 'ê°•ì (Strengths)', '4', 5)) return;

                trainingData.strategy = {
                    swot_s,
                    swot_w: document.getElementById('swot-w').value,
                    swot_o: document.getElementById('swot-o').value,
                    swot_t: document.getElementById('swot-t').value,
                    competitor: document.getElementById('s-competitor').value
                };
                
                const context = `
- **í˜ë¥´ì†Œë‚˜ ë‹ˆì¦ˆ**: ${trainingData.persona?.pain || 'N/A'}
- **ì—¬ì • Pain Point**: ${trainingData.journey?.step3 || 'N/A'}
- **í•µì‹¬ VOC**: ${trainingData.vocInput?.substring(0, 50) || 'N/A'}...`;

                const prompt = promptTemplates.strategy(trainingData.strategy, context);
                generateContent(prompt, `B2B ì„œë¹„ìŠ¤ ê³¼ì œ ìš°ì„ ìˆœìœ„ ë¶„ì„`, 'strategy-generator-btn');
                saveTrainingData();
            });

            // Slide 5: Script
            document.getElementById('m5-script-btn')?.addEventListener('click', () => {
                clearValidationError('5');
                const situation = document.getElementById('m5-situation').value;
                if (!validateInput(situation, 'ìƒë‹´/í´ë ˆì„ ìƒí™©', '5', 15)) return;

                trainingData.scriptSituation = situation;

                let context = `
- **ê³ ê° í˜ë¥´ì†Œë‚˜**: ${JSON.stringify(trainingData.persona, null, 2) || 'N/A'}
- **ìš°ë¦¬íŒ€ ë¶„ì„**: ${JSON.stringify(trainingData.strategy, null, 2) || 'N/A'}
- **ì£¼ìš” MOT(ì§€ë¢°)**: ${trainingData.journey?.step3 || 'N/A'}`;

                const prompt = promptTemplates.script(trainingData.scriptSituation, context);
                generateContent(prompt, `ë§ì¶¤í˜• ì‘ëŒ€ ìŠ¤í¬ë¦½íŠ¸`, 'm5-script-btn');
                saveTrainingData();
            });

            // Slide 7: Final Report
            document.getElementById('final-report-btn')?.addEventListener('click', () => {
                clearValidationError('7');
                // Final report depends on previous data, check if at least persona exists
                if (!trainingData.persona?.name) {
                    validateInput('', 'ì›Œí¬ìƒµ ë°ì´í„°ê°€', '7', 999); // Show error
                    return;
                }
                const prompt = promptTemplates.finalReport(trainingData);
                generateContent(prompt, "B2B CX ì†”ë£¨ì…˜ ë© ìµœì¢… ë³´ê³ ì„œ", 'final-report-btn');
            });
            
            // --- 12. INITIALIZE ---
            
            // Add listeners for auto-saving
            const debouncedSave = debounce(saveTrainingData, 500);
            document.querySelectorAll('input, textarea, select').forEach(el => {
                el.addEventListener('input', debouncedSave);
            });
            
            // Add listener for clear button
            document.getElementById('clear-data-btn').addEventListener('click', clearTrainingData);
            
            // Add keyboard listeners
            document.addEventListener('keydown', (e) => {
                // Only act if modal is hidden
                if (modal.classList.contains('hidden')) {
                    if (e.key === 'ArrowRight' && !nextBtn.disabled) {
                        nextBtn.click();
                    } else if (e.key === 'ArrowLeft' && !prevBtn.disabled) {
                        prevBtn.click();
                    }
                } else {
                    // If modal is open, Escape key should close it
                    if (e.key === 'Escape') {
                        closeModal();
                    }
                }
            });

            // Load data, setup progress bar, and show first slide
            loadTrainingData();
            setupProgressIndicator();
            showSlide(currentSlide);
        });
    </script>
</body>
</html>
